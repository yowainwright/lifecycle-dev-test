---
version: 0.0.3-alpha-1


environment:
  enabledFeatures: ['showLifecycleVersion']
  defaultServices:
    - name: "lifecycle-dev-test"
    - name: "lifecycle-codefresh-test"

services:
  - name: lifecycle-dev-test
    github:
      repository: yowainwright/lifecycle-dev-test
      branchName: main
      docker:
        defaultTag: main
        app:
          dockerfilePath: Dockerfile
          env:
            COMPONENT: app
          ports:
            - 8080
      deployment:
        public: true
        capacityType: "SPOT"
        resource:
          cpu:
            request: "10m"
          memory:
            request: "100Mi"
        readiness:
          tcpSocketPort: 8090
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 1
          successThreshold: 1
          failureThreshold: 5
        hostnames:
          host: "lifecycle.dev.goodrx.com"
          defaultInternalHostname: "lifecycle-test-good-dev-0"
          defaultPublicUrl: "lifecycle-test-good-dev-0.lifecycle.dev.goodrx.com"
  - name: lifecycle-codefresh-test
    codefresh:
      repository: yowainwright/lifecycle-dev-test
      branchName: main
      env:
        COMPUTE_BUILD_ENABLED: true
      deploy:
        pipelineId: '61a832aecb657804cd847dc4'
        trigger: 'pr_verify'
      destroy:
        pipelineId: '61a832aecb657804cd847dc4'
        trigger: 'pr_verify'
